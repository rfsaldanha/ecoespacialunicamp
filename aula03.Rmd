---
title: "Econometria espacial com R - Aula 03"
author: "Raphael Saldanha, Eduardo Almeida"
subtitle: Unicamp, julho de 2017
output:
  pdf_document: default
  html_notebook: default
  html_document: default
---

# Modelos espaciais

## Pacote

```{r}
library(spdep)
```


## Shapefile

```{r}
# Pacotes
library(rgdal)

# Abra o arquivo 'gm10.shp'
fp_mg.shp <- readOGR("data", "FP_MG", encoding = "ISO-8859-1")

# Plotar o mapa
plot(fp_mg.shp)
```

## Matriz de vizinhança

```{r}
w1 <- nb2listw(poly2nb(fp_mg.shp, queen = TRUE))
```


## Especificação do modelo

```{r}
esp <- Q ~ AC + LP
```

## OLS

$y = \alpha + X\beta + \varepsilon$

```{r}
mod1 <- lm(formula = esp, data = fp_mg.shp@data)
summary(mod1)
```

## Multiplicador de Lagrange

```{r}
mod1.lagrange <- lm.LMtests(model = mod1, listw = w1,
                            test = c("LMerr","RLMerr","LMlag","RLMlag",
                            "SARMA"))
mod1.lagrange
```

## SAR

$y = \rho W y + X \beta + \varepsilon$

```{r}
mod1.sar <- lagsarlm(formula = esp, data = fp_mg.shp@data, listw = w1)
summary(mod1.sar)
impacts(mod1.sar, listw = w1)
```

## SEM

$y = X \beta + u \\ u = \lambda Wu + \varepsilon$

```{r}
mod1.sem <- errorsarlm(formula = esp, data = fp_mg.shp@data, listw = w1)
summary(mod1.sem)
```

```{r}
mod1.semGMM <- GMerrorsar(formula = esp, data = fp_mg.shp@data, listw = w1)
summary(mod1.semGMM)
```


## SAC

$y = \rho Wy + X \beta + u \\ u = \lambda Wu + \varepsilon$

```{r}
mod1.sac <- sacsarlm(formula = esp, data = fp_mg.shp@data, listw = w1)
summary(mod1.sac)
impacts(mod1.sac, listw = w1)
```

```{r}
mod1.sacGMM <- gstsls(formula = esp, data = fp_mg.shp@data, listw = w1)
summary(mod1.sacGMM)
impacts(mod1.sacGMM, listw = w1)
```


## SMA

$y = X \beta + u \\ u = \lambda W \varepsilon + \varepsilon$

```{r}
mod1.sma <- spautolm(formula = esp, data = fp_mg.shp@data, listw = w1, family = "SMA")
summary(mod1.sma)
```

## SLX

$y = X \beta + WX \theta + \varepsilon$

```{r}
mod1.slx <- lmSLX(formula = esp, data = fp_mg.shp@data, listw = w1)
summary(mod1.slx)
impacts(mod1.slx)
```

## SDM

$y = \rho Wy + X \beta + WX \theta + \varepsilon$

```{r}
mod1.sdm <- lagsarlm(formula = esp, data = fp_mg.shp@data, listw = w1, type = "mixed")
summary(mod1.sdm)
impacts(mod1.sdm, listw = w1)
```

## SDEM

$y = X \beta + WX \theta + u \\ u = \lambda Wu + \varepsilon$

```{r}
mod1.sdem <- errorsarlm(formula = esp, data = fp_mg.shp@data, listw = w1, etype = "emixed")
summary(mod1.sdem)
```

